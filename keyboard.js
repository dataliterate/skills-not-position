/**
 * Title: KeyboardJS
 * Version: v0.4.1
 * Description: KeyboardJS is a flexible and easy to use keyboard binding
 * library.
 * Author: Robert Hurst.
 *
 * Copyright 2011, Robert William Hurst
 * Licenced under the BSD License.
 * See https://raw.github.com/RobertWHurst/KeyboardJS/master/license.txt
 */
(function(a,b){function c(){function a(){var c;return c=b("amd"),c.fork=a,c}return a()}function d(){function d(){function g(){var d;for(newNamespaces=Array.prototype.slice.apply(arguments),d=0;e.length>d;d+=1)f[e[d]]===void 0?delete a[e[d]]:a[e[d]]=f[e[d]];for(f={},d=0;newNamespaces.length>d;d+=1){if("string"!=typeof newNamespaces[d])throw Error("Cannot replace namespaces. All new namespaces must be strings.");f[newNamespaces[d]]=a[newNamespaces[d]],a[newNamespaces[d]]=c}return e=newNamespaces}var c,e=[],f={};return c=b("global"),c.fork=d,c.noConflict=g,c}var c;c=d(),c.noConflict("KeyboardJS","k")}[].indexOf||(Array.prototype.indexOf=function(a,b,c){for(c=this.length,b=(c+~~b)%c;c>b&&(!(b in this)||this[b]!==a);b++);return b^c?b:-1}),"function"==typeof define&&define.amd?define(c):d()})(this,function(){function k(){window.addEventListener?(document.addEventListener("keydown",n,!1),document.addEventListener("keyup",o,!1),window.addEventListener("blur",m,!1)):window.attachEvent&&(document.attachEvent("onkeydown",n),document.attachEvent("onkeyup",o),window.attachEvent("onblur",m))}function l(){m(),window.removeEventListener?(document.removeEventListener("keydown",n,!1),document.removeEventListener("keyup",o,!1),window.removeEventListener("blur",m,!1)):window.detachEvent&&(document.detachEvent("onkeydown",n),document.detachEvent("onkeyup",o),window.detachEvent("onblur",m))}function m(a){g=[],u(),z(a)}function n(a){var b,c;if(b=p(a.keyCode),!(1>b.length)){for(c=0;b.length>c;c+=1)G(b[c]);t(),y(a)}}function o(a){var b,c;if(b=p(a.keyCode),!(1>b.length)){for(c=0;b.length>c;c+=1)H(b[c]);u(),z(a)}}function p(a){return e[a]||[]}function q(a){var b;for(b in e)if(e.hasOwnProperty(b)&&e[b].indexOf(a)>-1)return b;return!1}function r(a,b){if("string"!=typeof a&&("object"!=typeof a||"function"!=typeof a.push))throw Error("Cannot create macro. The combo must be a string or array.");if("object"!=typeof b||"function"!=typeof b.push)throw Error("Cannot create macro. The injectedKeys must be an array.");marcos.push([a,injectKeys])}function s(a){var b;if("string"!=typeof a&&("object"!=typeof a||"function"!=typeof a.push))throw Error("Cannot remove macro. The combo must be a string or array.");for(mI=0;f.length>mI;mI+=1)if(b=f[mI],A(a,b[0])){H(b[1]),f.splice(mI,1);break}}function t(){var a,b,c;for(a=0;f.length>a;a+=1)if(b=D(f[a][0]),-1===j.indexOf(f[a])&&B(b))for(j.push(f[a]),c=0;f[a][1].length>c;c+=1)G(f[a][1][c])}function u(){var a,b,c;for(a=0;j.length>a;a+=1)if(b=D(j[a][0]),B(b)===!1){for(c=0;j[a][1].length>c;c+=1)H(j[a][1][c]);j.splice(a,1),a-=1}}function v(a,b,c){function k(){var a;for(a=0;f.length>a;a+=1)h.splice(h.indexOf(f[a]),1)}function l(a){function g(){var b,d;for(b=0;c.length>b;b+=1)if("function"==typeof c[b])if("keyup"===a)for(d=0;f.length>d;d+=1)f[d].keyUpCallback.splice(f[d].keyUpCallback.indexOf(c[b]),1);else for(d=0;f.length>d;d+=1)f[d].keyDownCallback.splice(f[d].keyDownCallback.indexOf(c[b]),1)}var c,d,e,b={};if("string"!=typeof a)throw Error("Cannot bind callback. The event name must be a string.");if("keyup"!==a&&"keydown"!==a)throw Error('Cannot bind callback. The event name must be a "keyup" or "keydown".');for(c=Array.prototype.slice.apply(arguments,[1]),d=0;c.length>d;d+=1)if("function"==typeof c[d])if("keyup"===a)for(e=0;f.length>e;e+=1)f[e].keyUpCallback.push(c[d]);else if("keydown"===a)for(e=0;f.length>e;e+=1)f[e].keyDownCallback.push(c[d]);return b.clear=g,b}var e,i,j,d={},f=[];for("string"==typeof a&&(a=D(a)),i=0;a.length>i;i+=1){if(e={},j=E([a[i]]),"string"!=typeof j)throw Error("Failed to bind key combo. The key combo must be string.");e.keyCombo=j,e.keyDownCallback=[],e.keyUpCallback=[],b&&e.keyDownCallback.push(b),c&&e.keyUpCallback.push(c),h.push(e),f.push(e)}return d.clear=k,d.on=l,d}function w(a){var b,c;for(b=0;h.length>b;b+=1)c=h[b],A(a,c.keyCombo)&&(h.splice(b,1),b-=1)}function x(a){var b,c,d;for(b=0;h.length>b;b+=1)for(d=h[b],c=0;d.keyCombo.length>c;c+=1)if(d.keyCombo[kI].indexOf(a)>-1){h.splice(b,1),b-=1;break}}function y(a){var b,c,d,f,j,k,l,m,n,p,o=[];for(f=[].concat(g),b=0;h.length>b;b+=1)p=C(h[b].keyCombo).length,o[p]||(o[p]=[]),o[p].push(h[b]);for(c=o.length-1;c>=0;c-=1)if(o[c])for(b=0;o[c].length>b;b+=1){for(d=o[c][b],bindingKeys=C(d.keyCombo),m=!0,l=0;bindingKeys.length>l;l+=1)if(-1===f.indexOf(bindingKeys[l])){m=!1;break}if(m&&B(d.keyCombo)){for(i.push(d),l=0;bindingKeys.length>l;l+=1)n=f.indexOf(bindingKeys[l]),n>-1&&(f.splice(n,1),l-=1);for(j=0;d.keyDownCallback.length>j;j+=1)d.keyDownCallback[j](a)===!1&&(k=!0);k===!0&&(a.preventDefault(),a.stopPropagation())}}}function z(a){var b,c,d,e;for(b=0;i.length>b;b+=1)if(d=i[b],B(d.keyCombo)===!1){for(c=0;d.keyUpCallback.length>c;c+=1)d.keyUpCallback[c](a)===!1&&(e=!0);e===!0&&(a.preventDefault(),a.stopPropagation()),i.splice(b,1),b-=1}}function A(a,b){var c,d,e;if(a=D(a),b=D(b),a.length!==b.length)return!1;for(c=0;a.length>c;c+=1){if(a[aI].length!==b[aI].length)return!1;for(d=0;a[aI].length>d;d+=1){if(a[aI][d].length!==b[aI][d].length)return!1;for(e=0;a[aI][d].length>e;e+=1)if(-1===b[aI][d].indexOf(a[aI][d][e]))return!1}}return!0}function B(a){var b,c,d,e,h,f=0;for(a=D(a),b=0;a.length>b;b+=1)for(c=0;a[b].length>c;c+=1){for(d=[].concat(a[b][c]),e=f;g.length>e;e+=1)h=d.indexOf(g[e]),h>-1&&(d.splice(h,1),f=e);if(0!==d.length)return!1}return!0}function C(a){var b,c,e=[];for(a=D(a),b=0;a.length>b;b+=1)for(c=0;a[b].length>c;c+=1)e=e.concat(a[b][c]);return e}function D(a){var b=a,c=0,d=0,e=!1,f=!1,g=[],h=[],i=[],j="";if("object"==typeof a&&"function"==typeof a.push)return a;if("string"!=typeof a)throw Error('Cannot parse "keyCombo" because its type is "'+typeof a+'". It must be a "string".');for(;" "===b.charAt(c);)c+=1;for(;;){if(" "===b.charAt(c)){for(;" "===b.charAt(c);)c+=1;e=!0}else if(","===b.charAt(c)){if(d||f)throw Error("Failed to parse key combo. Unexpected , at character index "+c+".");f=!0,c+=1}else if("+"===b.charAt(c)){if(j.length&&(i.push(j),j=""),d||f)throw Error("Failed to parse key combo. Unexpected + at character index "+c+".");d=!0,c+=1}else if(">"===b.charAt(c)){if(j.length&&(i.push(j),j=""),i.length&&(h.push(i),i=[]),d||f)throw Error("Failed to parse key combo. Unexpected > at character index "+c+".");d=!0,c+=1}else if(b.length-1>c&&"!"===b.charAt(c)&&(">"===b.charAt(c+1)||","===b.charAt(c+1)||"+"===b.charAt(c+1)))j+=b.charAt(c+1),d=!1,e=!1,f=!1,c+=2;else{if(!(b.length>c&&"+"!==b.charAt(c)&&">"!==b.charAt(c)&&","!==b.charAt(c)&&" "!==b.charAt(c))){c+=1;continue}for((d===!1&&e===!0||f===!0)&&(j.length&&(i.push(j),j=""),i.length&&(h.push(i),i=[]),h.length&&(g.push(h),h=[])),d=!1,e=!1,f=!1;b.length>c&&"+"!==b.charAt(c)&&">"!==b.charAt(c)&&","!==b.charAt(c)&&" "!==b.charAt(c);)j+=b.charAt(c),c+=1}if(c>=b.length){j.length&&(i.push(j),j=""),i.length&&(h.push(i),i=[]),h.length&&(g.push(h),h=[]);break}}return g}function E(a){var b,c,d=[];if("string"==typeof a)return a;if("object"!=typeof a||"function"!=typeof a.push)throw Error("Cannot stringify key combo.");for(b=0;a.length>b;b+=1){for(d[b]=[],c=0;a[b].length>c;c+=1)d[b][c]=a[b][c].join(" + ");d[b]=d[b].join(" > ")}return d.join(" ")}function F(){return[].concat(g)}function G(a){if(a.match(/\s/))throw Error("Cannot add key name "+a+" to active keys because it contains whitespace.");g.indexOf(a)>-1||g.push(a)}function H(a){var b=q(a);"91"===b||"92"===b?g=[]:g.splice(g.indexOf(a),1)}function I(a,b){if("string"!=typeof a)throw Error("Cannot register new locale. The locale name must be a string.");if("object"!=typeof b)throw Error("Cannot register "+a+" locale. The locale map must be an object.");if("object"!=typeof b.map)throw Error("Cannot register "+a+" locale. The locale map is invalid.");b.macros||(b.macros=[]),c[a]=b}function J(a){if(a){if("string"!=typeof a)throw Error("Cannot set locale. The locale name must be a string.");if(!c[a])throw Error("Cannot set locale to "+a+" because it does not exist. If you would like to submit a "+a+" locale map for KeyboardJS please submit it at https://github.com/RobertWHurst/KeyboardJS/issues.");e=c[a].map,f=c[a].macros,d=a}return d}var d,e,f,b={},c={},g=[],h=[],i=[],j=[];return I("us",{map:{3:["cancel"],8:["backspace"],9:["tab"],12:["clear"],13:["enter"],16:["shift"],17:["ctrl"],18:["alt","menu"],19:["pause","break"],20:["capslock"],27:["escape","esc"],32:["space","spacebar"],33:["pageup"],34:["pagedown"],35:["end"],36:["home"],37:["left"],38:["up"],39:["right"],40:["down"],41:["select"],42:["printscreen"],43:["execute"],44:["snapshot"],45:["insert","ins"],46:["delete","del"],47:["help"],91:["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"],92:["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"],145:["scrolllock","scroll"],186:["semicolon",";"],187:["equal","equalsign","="],188:["comma",","],189:["dash","-"],190:["period","."],191:["slash","forwardslash","/"],192:["graveaccent","`"],219:["openbracket","["],220:["backslash","\\"],221:["closebracket","]"],222:["apostrophe","'"],65:["a"],66:["b"],67:["c"],68:["d"],69:["e"],70:["f"],71:["g"],72:["h"],73:["i"],74:["j"],75:["k"],76:["l"],77:["m"],78:["n"],79:["o"],80:["p"],81:["q"],82:["r"],83:["s"],84:["t"],85:["u"],86:["v"],87:["w"],88:["x"],89:["y"],90:["z"],48:["zero","0"],49:["one","1"],50:["two","2"],51:["three","3"],52:["four","4"],53:["five","5"],54:["six","6"],55:["seven","7"],56:["eight","8"],57:["nine","9"],96:["numzero","num0"],97:["numone","num1"],98:["numtwo","num2"],99:["numthree","num3"],100:["numfour","num4"],101:["numfive","num5"],102:["numsix","num6"],103:["numseven","num7"],104:["numeight","num8"],105:["numnine","num9"],106:["nummultiply","num*"],107:["numadd","num+"],108:["numenter"],109:["numsubtract","num-"],110:["numdecimal","num."],111:["numdevide","num/"],144:["numlock","num"],112:["f1"],113:["f2"],114:["f3"],115:["f4"],116:["f5"],117:["f6"],118:["f7"],119:["f8"],120:["f9"],121:["f10"],122:["f11"],123:["f12"]},macros:[[[[["shift","graveaccent"]]],["tilde","~"]],[[[["shift","one"]]],["exclamation","exclamationpoint","!"]],[[[["shift","two"]]],["at","@"]],[[[["shift","three"]]],["number","#"]],[[[["shift","four"]]],["dollar","dollars","dollarsign","$"]],[[[["shift","five"]]],["percent","%"]],[[[["shift","six"]]],["caret","^"]],[[[["shift","seven"]]],["ampersand","and","&"]],[[[["shift","eight"]]],["asterisk","*"]],[[[["shift","nine"]]],["openparen","("]],[[[["shift","zero"]]],["closeparen",")"]],[[[["shift","dash"]]],["underscore","_"]],[[[["shift","equal"]]],["plus","+"]],[[[["shift","openbracket"]]],["opencurlybrace","opencurlybracket","{"]],[[[["shift","closebracket"]]],["closecurlybrace","closecurlybracket","}"]],[[[["shift","backslash"]]],["verticalbar","|"]],[[[["shift","semicolon"]]],["colon",":"]],[[[["shift","apostrophe"]]],["quotationmark",'"']],[[[["shift","comma"]]],["openanglebracket","<"]],[[[["shift","period"]]],["closeanglebracket",">"]],[[[["shift","forwardslash"]]],["questionmark","?"]],[[[["shift","a"]]],["A"]],[[[["shift","b"]]],["B"]],[[[["shift","c"]]],["C"]],[[[["shift","d"]]],["D"]],[[[["shift","e"]]],["E"]],[[[["shift","f"]]],["F"]],[[[["shift","g"]]],["G"]],[[[["shift","h"]]],["H"]],[[[["shift","i"]]],["I"]],[[[["shift","j"]]],["J"]],[[[["shift","k"]]],["K"]],[[[["shift","l"]]],["L"]],[[[["shift","m"]]],["M"]],[[[["shift","n"]]],["N"]],[[[["shift","o"]]],["O"]],[[[["shift","p"]]],["P"]],[[[["shift","q"]]],["Q"]],[[[["shift","r"]]],["R"]],[[[["shift","s"]]],["S"]],[[[["shift","t"]]],["T"]],[[[["shift","u"]]],["U"]],[[[["shift","v"]]],["V"]],[[[["shift","w"]]],["W"]],[[[["shift","x"]]],["X"]],[[[["shift","y"]]],["Y"]],[[[["shift","z"]]],["Z"]]]}),J("us"),k(),b.enable=k,b.disable=l,b.activeKeys=F,b.on=v,b.clear=w,b.clear.key=x,b.locale=J,b.locale.register=I,b.macro=r,b.macro.remove=s,b.key={},b.key.name=p,b.key.code=q,b.combo={},b.combo.parse=D,b.combo.stringify=E,b});